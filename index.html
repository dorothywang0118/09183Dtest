<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>3D 狐狸 AR</title>
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- AR.js for A-Frame -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <script>
      // 載入後幫模型「上顏色」並開啟陰影
      AFRAME.registerComponent('colorize-fox', {
        init: function () {
          this.el.addEventListener('model-loaded', (e) => {
            const model = e.detail.model;
            model.traverse((node) => {
              if (node.isMesh) {
                // 橘色身體
                node.material = new THREE.MeshStandardMaterial({
                  color: 0xff8c00,  // 橘
                  roughness: 0.9,
                  metalness: 0.0
                });
                node.castShadow = true;
                node.receiveShadow = true;
              }
            });
          });
        }
      });

      // 讓模型微微擺動（可關閉）
      AFRAME.registerComponent('idle-bob', {
        schema: {amp:{default:0.03}, speed:{default:2}},
        tick: function (t) {
          const y0 = 0.0;
          const a = this.data.amp;
          const s = this.data.speed;
          this.el.object3D.position.y = y0 + Math.sin(t/1000 * s) * a;
        }
      });
    </script>
  </head>

  <body style="margin:0; overflow:hidden;">
    <a-scene
      embedded
      vr-mode-ui="enabled:false"
      renderer="alpha:true; antialias:true; physicallyCorrectLights:true"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled:false">

      <!-- 燈光（3D 不然會黑）-->
      <a-entity light="type: ambient; intensity: 0.9"></a-entity>
      <a-entity light="type: directional; intensity: 0.9"
                position="0 2 1"></a-entity>

      <!-- 把 3D 模型掛在 Hiro 標記上 -->
      <a-marker preset="hiro">
        <!-- 位置在標記中心，稍微縮小；如果方向反了，把 rotation 的 180 改成 0 試試 -->
        <a-entity id="fox3d"
                  gltf-model="assets/q_fox.glb"
                  position="0 0 0"
                  rotation="0 180 0"
                  scale="0.3 0.3 0.3"
                  colorize-fox
                  idle-bob>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
